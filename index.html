<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>加药计算器</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
  background: #f5f6f7;
  margin: 0;
  padding: 10px;
}
.section {
  background: #fff;
  border-radius: 12px;
  padding: 12px;
  margin-bottom: 12px;
}
input, textarea, button {
  width: 100%;
  font-size: 16px;
  margin-top: 6px;
}
button {
  height: 44px;
  border-radius: 8px;
}
textarea {
  height: 80px;
}
</style>
</head>

<body>

<div class="section">
  <h3>进水量</h3>
  <textarea id="hiddenTxt" placeholder="粘贴微信数据"></textarea>
  <button onclick="readCpy()">获取进水量</button>
  <button onclick="clean()">清空</button>

  <p>
    一二系列 <input id="12">
    三四系列 <input id="34">
    五六系列 <input id="56">
  </p>
</div>

<div class="section">
  <h3>一期加药</h3>
  混凝剂浓度% <input id="hn_con" value="10">
  助凝剂浓度% <input id="zn_con" value="5">

  <p>
    HN1 <input id="HN_adiff">
    HN2 <input id="HN_bdiff">
    HN3 <input id="HN_cdiff">
    HN4 <input id="HN_ddiff">
  </p>

  <p>
    ZN1 <input id="ZN_adiff">
    ZN2 <input id="ZN_bdiff">
    ZN3 <input id="ZN_cdiff">
    ZN4 <input id="ZN_ddiff">
  </p>
</div>

<div class="section">
  <h3>二期加药</h3>
  混凝剂浓度% <input id="hn_con2" value="10">
  助凝剂浓度% <input id="zn_con2" value="5">

  <p>
    HN5-1 <input id="HN_ediff1">
    HN5-2 <input id="HN_ediff2">
    HN6-1 <input id="HN_fdiff1">
    HN6-2 <input id="HN_fdiff2">
  </p>

  <p>
    ZN5-1 <input id="ZN_ediff1">
    ZN5-2 <input id="ZN_ediff2">
    ZN6-1 <input id="ZN_fdiff1">
    ZN6-2 <input id="ZN_fdiff2">
  </p>

  <button onclick="do_cal()">计算</button>
  <textarea id="result"></textarea>
  <button onclick="copy()">复制结果</button>
</div>

<script>
/* ===== 原有逻辑（未改） ===== */

function readCpy(){
  const txt = hiddenTxt.value;
  if(!txt) return;
  const nums = txt.match(/\d+(\.\d+)?/g);
  if(!nums || nums.length < 3) return;
  document.getElementById("12").value = nums[0];
  document.getElementById("34").value = nums[1];
  document.getElementById("56").value = nums[2];
}

function clean(){
  hiddenTxt.value="";
}

function do_cal(){
  var ab=+document.getElementById("12").value;
  var cd=+document.getElementById("34").value;
  var ef=+document.getElementById("56").value;

  var hn=hn_con.value/100;
  var zn=zn_con.value/100;

  result.value =
    "一期:\n" +
    (HN_adiff.value*hn*2*10000/ab).toFixed(2) + " " +
    (HN_bdiff.value*hn*2*10000/ab).toFixed(2) + " " +
    (HN_cdiff.value*hn*2*10000/cd).toFixed(2) + " " +
    (HN_ddiff.value*hn*2*10000/cd).toFixed(2) + "\n" +
    (ZN_adiff.value*zn*2*10000/ab).toFixed(2) + " " +
    (ZN_bdiff.value*zn*2*10000/ab).toFixed(2) + " " +
    (ZN_cdiff.value*zn*2*10000/cd).toFixed(2) + " " +
    (ZN_ddiff.value*zn*2*10000/cd).toFixed(2);
}

function copy(){
  result.select();
  document.execCommand("copy");
}
</script>

<script>
/* ===== 新增：自动保存 / 自动恢复（监听） ===== */

const SAVE_KEY = "cal_tools_autosave";

function saveData(){
  const data = {};
  document.querySelectorAll("input, textarea").forEach(el=>{
    if(el.id){
      data[el.id] = el.value;
    }
  });
  localStorage.setItem(SAVE_KEY, JSON.stringify(data));
}

function loadData(){
  const raw = localStorage.getItem(SAVE_KEY);
  if(!raw) return;
  const data = JSON.parse(raw);
  Object.keys(data).forEach(id=>{
    const el = document.getElementById(id);
    if(el){
      el.value = data[id];
    }
  });
}

window.addEventListener("load", loadData);
document.addEventListener("input", saveData);
</script>

</body>
</html>