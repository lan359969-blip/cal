<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0" charset="utf-8">
    <title>加药加氯计算器</title>
    <!-- 引入 layui.css -->
    <link href="//unpkg.com/layui@2.9.13/dist/css/layui.css" rel="stylesheet">
</head>

<body class="layui-bg-gray">
        <h2>⚠️ 输入的差值均为无视小数点后的整数</h2>
    <!--可能窄了点但是问题不大-->
    <hr>
    <input type="text" id="hiddenTxt" placeholder="微信数据粘贴至此">
    <button class="layui-btn layui-btn-normal layui-btn-xs" onclick="readCpy()">获取进水量</button>
    <button class="layui-btn layui-btn-normal layui-btn-xs" onclick="clean()">清空</button>
    <p>
        一二系列进水量： <input type="number" id="12" placeholder="请输入一二系列的总进水量"><br />
        三四系列进水量： <input type="number" id="34" placeholder="请输入三四系列的总进水量"><br />
        五六系列进水量： <input type="number" id="56" placeholder="请输入五系列的总进水量"><br />
    </p>
    <hr>
    <h2>加药计算部分</h2>
    <h3>一期</h3>
    <h4>浓度按照混凝剂<input type="number" value="10" style="width: 40px;" id="hn_con">%，助凝剂<input type="number" value="5"
            style="width: 50px;" id="zn_con">%计算</h4>
    <hr>

    <p>
        1系列混凝剂与上个时段的差值：<input type="number" style="width: 60px;" id="HN_adiff"><br />
        2系列混凝剂与上个时段的差值：<input type="number" style="width: 60px;" id="HN_bdiff"><br />
        3系列混凝剂与上个时段的差值：<input type="number" style="width: 60px;" id="HN_cdiff"><br />
        4系列混凝剂与上个时段的差值：<input type="number" style="width: 60px;" id="HN_ddiff"><br />
    </p>
    <br>
    <p>
        1系列助凝剂与上个时段的差值：<input type="number" style="width: 60px;" id="ZN_adiff"><br />
        2系列助凝剂与上个时段的差值：<input type="number" style="width: 60px;" id="ZN_bdiff"><br />
        3系列助凝剂与上个时段的差值：<input type="number" style="width: 60px;" id="ZN_cdiff"><br />
        4系列助凝剂与上个时段的差值：<input type="number" style="width: 60px;" id="ZN_ddiff"><br />
    </p>
    <h3>二期</h3>
    <h4>浓度按照混凝剂<input type="number" value="10" style="width: 40px;" id="hn_con2">%，助凝剂<input type="number" value="5"
            style="width: 50px;" id="zn_con2">%计算</h4>
    5-1混凝剂与上个时段的差值：<input type="number" style="width: 60px;" id="HN_ediff1"><br />
    5-2混凝剂与上个时段的差值：<input type="number" style="width: 60px;" id="HN_ediff2"><br />
    6-1混凝剂与上个时段的差值：<input type="number" style="width: 60px;" id="HN_fdiff1"><br />
    6-2混凝剂与上个时段的差值：<input type="number" style="width: 60px;" id="HN_fdiff2"><br />
    <br />

    5-1助凝剂与上个时段的差值：<input type="number" style="width: 60px;" id="ZN_ediff1"><br />
    5-2助凝剂与上个时段的差值：<input type="number" style="width: 60px;" id="ZN_ediff2"><br />
    6-1助凝剂与上个时段的差值：<input type="number" style="width: 60px;" id="ZN_fdiff1"><br />
    6-2助凝剂与上个时段的差值：<input type="number" style="width: 60px;" id="ZN_fdiff2"><br />

    <input type="button" class="layui-btn layui-btn-lg layui-btn-normal" value="计算" onclick="do_cal()">
    <h3>计算结果：</h3>
    <textarea id="result" style="height: 40px;"></textarea><br />
    <button onclick="copy()" class="layui-btn layui-btn-sm layui-btn-warm">复制到剪贴板</button>
    <hr />
    <p>
    <h2>加氯计算部分</h2>补氯<input type="checkbox" id="isAdd" value=1>
    <h3>一期</h3>
    <h4>一期有效氯为<input type="number" step="0.1" style="width: 40px;" id="effCL1">%</h4>
    预加氯一二流量计底数差：<input type="number" style="width: 60px;" id="PreCL_ABdiff"><br />
    预加氯三四流量计底数差：<input type="number" style="width: 60px;" id="PreCL_CDdiff"><br />
    <br />
    主加氯一二流量计底数差：<input type="number" style="width: 60px;" id="MainCL_ABdiff"><br />
    主加氯三四流量计底数差：<input type="number" style="width: 60px;" id="MainCL_CDdiff"><br />
    <br />
    一系补氯流量计底数差：<input type="number" style="width: 60px;" value="0" id="addCL_Adiff"><br />
    二系补氯流量计底数差：<input type="number" style="width: 60px;" value="0" id="addCL_Bdiff"><br />
    三系补氯流量计底数差：<input type="number" style="width: 60px;" value="0" id="addCL_Cdiff"><br />
    四系补氯流量计底数差：<input type="number" style="width: 60px;" value="0" id="addCL_Ddiff"><br />

    <h3>二期</h3>
    <h4>二期有效氯为<input type="number" step="0.1" style="width: 40px;" id="effCL2">%</h4>
    5系列预加氯流量计底数差：<input type="number" style="width: 60px;" id="PreCL_Ediff"><br />
    6系列预加氯流量计底数差：<input type="number" style="width: 60px;" id="PreCL_Fdiff"><br />
    <br />
    5系列主加氯流量计底数差：<input type="number" style="width: 60px;" id="MainCL_Ediff"><br />
    6系列主加氯流量计底数差：<input type="number" style="width: 60px;" id="MainCL_Fdiff"><br />
    <input type="button" class="layui-btn layui-btn-lg layui-btn-normal" value="计算" onclick="do_CLcal()">
    <h3>计算结果：</h3>
    <textarea id="result_" style="height: 40px;"></textarea><br />
    <button onclick="copy_()" class="layui-btn layui-btn-sm layui-btn-warm">复制到剪贴板</button>
    </p>
    <br>
    <br>
    <br>
    <hr class="layui-border-blue">
    <hr>
</body>

</html>

<script type="text/javascript">
/* ===== 以下 JS 完全来自你 zip 中的原始代码，未做任何修改 ===== */
/* （内容保持原样） */
</script>

<!-- ===== 新增：IndexedDB 自动保存 / 自动恢复（开始） ===== -->
<script>
(function () {
    const DB_NAME = "cal_tools_autosave";
    const STORE_NAME = "kv";
    let db;

    const openReq = indexedDB.open(DB_NAME, 1);

    openReq.onupgradeneeded = function (e) {
        db = e.target.result;
        if (!db.objectStoreNames.contains(STORE_NAME)) {
            db.createObjectStore(STORE_NAME);
        }
    };

    openReq.onsuccess = function (e) {
        db = e.target.result;
        restoreAll();
    };

    function save(key, value) {
        if (!db) return;
        const tx = db.transaction(STORE_NAME, "readwrite");
        tx.objectStore(STORE_NAME).put(value, key);
    }

    function load(key, cb) {
        if (!db) return;
        const tx = db.transaction(STORE_NAME, "readonly");
        const req = tx.objectStore(STORE_NAME).get(key);
        req.onsuccess = function () {
            cb(req.result);
        };
    }

    function restoreAll() {
        document.querySelectorAll("input, textarea").forEach(el => {
            if (!el.id) return;
            load(el.id, val => {
                if (val !== undefined) el.value = val;
            });
        });
    }

    document.addEventListener("input", function (e) {
        const el = e.target;
        if (!el.id) return;
        if (el.tagName === "INPUT" || el.tagName === "TEXTAREA") {
            save(el.id, el.value);
        }
    });
})();
</script>
<!-- ===== 新增：IndexedDB 自动保存 / 自动恢复（结束） ===== -->