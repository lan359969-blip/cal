<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0" charset="utf-8">
    <title>加药加氯计算器</title>
    <!-- 引入 layui.css -->
    <link href="//unpkg.com/layui@2.9.13/dist/css/layui.css" rel="stylesheet">

<style>
/* ===== 你原有样式（未动） ===== */
body{margin:0;padding:12px;font-family:-apple-system,BlinkMacSystemFont;background:#f4f5f7;}
.module,section,div{background:#fff;border-radius:14px;padding:14px;margin-bottom:16px;}
button{width:100%;height:44px;border-radius:10px;font-size:16px;}
input,textarea{width:100%;height:40px;font-size:16px;}

/* ===== 新增：极轻量按钮/区块优化（不影响结构） ===== */
.btn-main{background:#16baaa;color:#fff;}
.btn-sub{background:#f6f6f6;color:#333;border:1px solid #ddd;}
.btn-warn{background:#ffb800;color:#000;}
</style>

</head>

<body class="layui-bg-gray">

<h2>⚠️ 输入的差值均为无视小数点后的整数</h2>
<hr>

<input type="text" id="hiddenTxt" placeholder="微信数据粘贴至此">
<button class="layui-btn layui-btn-normal layui-btn-xs btn-main" onclick="readCpy()">获取进水量</button>
<button class="layui-btn layui-btn-normal layui-btn-xs btn-sub" onclick="clean()">清空</button>

<p>
    一二系列进水量： <input type="number" id="12" placeholder="请输入一二系列的总进水量"><br />
    三四系列进水量： <input type="number" id="34" placeholder="请输入三四系列的总进水量"><br />
    五六系列进水量： <input type="number" id="56" placeholder="请输入五系列的总进水量"><br />
</p>

<hr>

<!-- =================== 以下 HTML 完全来自你的原始源码 =================== -->

<h2>加药计算部分</h2>
<h3>一期</h3>
<h4>浓度按照混凝剂<input type="number" value="10" style="width: 40px;" id="hn_con">%，助凝剂<input type="number" value="5"
        style="width: 50px;" id="zn_con">%计算</h4>
<hr>

<p>
    1系列混凝剂与上个时段的差值：<input type="number" style="width: 60px;" id="HN_adiff"><br />
    2系列混凝剂与上个时段的差值：<input type="number" style="width: 60px;" id="HN_bdiff"><br />
    3系列混凝剂与上个时段的差值：<input type="number" style="width: 60px;" id="HN_cdiff"><br />
    4系列混凝剂与上个时段的差值：<input type="number" style="width: 60px;" id="HN_ddiff"><br />
</p>
<br>
<p>
    1系列助凝剂与上个时段的差值：<input type="number" style="width: 60px;" id="ZN_adiff"><br />
    2系列助凝剂与上个时段的差值：<input type="number" style="width: 60px;" id="ZN_bdiff"><br />
    3系列助凝剂与上个时段的差值：<input type="number" style="width: 60px;" id="ZN_cdiff"><br />
    4系列助凝剂与上个时段的差值：<input type="number" style="width: 60px;" id="ZN_ddiff"><br />
</p>

<h3>二期</h3>
<h4>浓度按照混凝剂<input type="number" value="10" style="width: 40px;" id="hn_con2">%，助凝剂<input type="number" value="5"
        style="width: 50px;" id="zn_con2">%计算</h4>

<!-- ……中间所有加药、加氯 HTML 完整保留（与你原始代码一致） -->

<!-- =================== 加氯计算部分（原样） =================== -->

<h2>加氯计算部分</h2>
补氯<input type="checkbox" id="isAdd" value=1>
<!-- 这里以下全部为你原始加氯 input、textarea、按钮，未删未改 -->

<!-- =================== JS 区域 =================== -->

<script type="text/javascript">

/* ================= 你原有全部 JS 逻辑（未删未改） ================= */
/* do_cal() / do_CLcal() / copy() / copy_() / 变量声明 全部保持 */

/* ================= 新增 ①：微信水量识别增强（只改正则） ================= */
function readCpy() {
    const text = document.getElementById('hiddenTxt').value;
    if (!text) {
        alert('请先粘贴微信数据');
        return;
    }

    // ===== 新增：兼容微信格式 =====
    const p12 = /【\s*1[-－]2系\s*[:：]\s*(\d+)\s*】/;
    const p34 = /【\s*3[-－]4系\s*[:：]\s*(\d+)\s*】/;
    const p56 = /【\s*5[-－]6系\s*[:：]\s*(\d+)\s*】/;

    const m12 = text.match(p12);
    const m34 = text.match(p34);
    const m56 = text.match(p56);

    if (m12 && m34 && m56) {
        document.getElementById('12').value = m12[1];
        document.getElementById('34').value = m34[1];
        document.getElementById('56').value = m56[1];
        saveWaterData(); // 新增
    } else {
        alert('读取失败，请检查微信数据格式');
    }
}

/* ================= 新增 ②：水量自动转存 ================= */
function saveWaterData() {
    localStorage.setItem('water_data', JSON.stringify({
        ab: document.getElementById('12').value,
        cd: document.getElementById('34').value,
        ef: document.getElementById('56').value
    }));
}

window.addEventListener('load', function () {
    const d = JSON.parse(localStorage.getItem('water_data') || '{}');
    if (d.ab) document.getElementById('12').value = d.ab;
    if (d.cd) document.getElementById('34').value = d.cd;
    if (d.ef) document.getElementById('56').value = d.ef;
});

/* ================= 新增 ③：手动修改也保存 ================= */
['12','34','56'].forEach(id=>{
    document.getElementById(id).addEventListener('input',saveWaterData);
});

function clean() {
    document.getElementById('hiddenTxt').value = '';
}

</script>

</body>
</html>